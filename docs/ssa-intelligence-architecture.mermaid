graph TB
    %% Styling
    classDef user fill:#f9f0ff,stroke:#7c3aed,stroke-width:2px,color:#1e1e1e
    classDef proxy fill:#fef3c7,stroke:#d97706,stroke-width:2px,color:#1e1e1e
    classDef app fill:#dbeafe,stroke:#2563eb,stroke-width:2px,color:#1e1e1e
    classDef frontend fill:#d1fae5,stroke:#059669,stroke-width:2px,color:#1e1e1e
    classDef db fill:#fee2e2,stroke:#dc2626,stroke-width:2px,color:#1e1e1e
    classDef external fill:#e0e7ff,stroke:#4f46e5,stroke-width:2px,color:#1e1e1e
    classDef storage fill:#fce7f3,stroke:#db2777,stroke-width:2px,color:#1e1e1e
    classDef internal fill:#f0fdf4,stroke:#16a34a,stroke-width:1px,color:#1e1e1e,stroke-dasharray:5 5
    classDef render fill:#f8fafc,stroke:#475569,stroke-width:3px,color:#1e1e1e

    %% Users
    User["ğŸ‘¤ SSA Analyst<br/><i>@ssaandco.com</i>"]:::user

    %% Auth Proxy
    OAuthProxy["ğŸ” oauth2-proxy<br/><i>SSO Gateway</i><br/><small>Microsoft Entra ID</small>"]:::proxy

    %% Render Deployment Boundary
    subgraph Render["â˜ï¸ Render Platform"]
        direction TB

        subgraph AppContainer["ğŸ³ Docker Container<br/><small>playwright:v1.58.2-jammy</small>"]
            direction TB

            FrontendStatic["ğŸ“± React SPA<br/><i>Static Files</i><br/><small>React 19 Â· Tailwind Â· Vite</small>"]:::frontend

            subgraph Backend["âš™ï¸ Express Backend<br/><small>Node.js 20 Â· TypeScript Â· Port 3000</small>"]
                direction TB

                API["ğŸŒ REST API<br/><small>Route Handlers</small><br/><small>Auth Â· Rate Limit Â· CORS</small>"]:::app

                subgraph Workers["Background Processes"]
                    direction LR
                    JobQueue["ğŸ“‹ Research Queue<br/><small>PG Advisory Locks</small><br/><small>Max 3 concurrent</small>"]:::internal
                    Cron["â° News Scheduler<br/><small>node-cron</small><br/><small>Daily 05:00 UTC</small>"]:::internal
                end

                subgraph Services["Core Services"]
                    direction LR
                    Orchestrator["ğŸ”¬ Orchestrator<br/><small>Multi-stage Pipeline</small><br/><small>Foundation â†’ Sections â†’ Export</small>"]:::internal
                    Export["ğŸ“„ Export Engine<br/><small>PDF Â· DOCX Â· Markdown</small>"]:::internal
                    NewsFetcher["ğŸ“° News Fetcher<br/><small>RSS Aggregation</small><br/><small>+ LLM Categorization</small>"]:::internal
                end

                Playwright["ğŸ­ Playwright<br/><small>Chromium (in-process)</small><br/><small>PDF Rendering</small>"]:::internal
            end
        end

        PostgreSQL[("ğŸ—„ï¸ PostgreSQL 15+<br/><i>Render Managed</i><br/><small>Prisma ORM</small><br/><small>Advisory locks Â· Migrations</small>")]:::db
    end

    %% External Services
    Claude["ğŸ¤– Anthropic Claude API<br/><small>claude-sonnet-4-5</small><br/><small>Research + News Classification</small>"]:::external
    RSS["ğŸ“¡ RSS Feeds<br/><small>Google News</small><br/><small>AltAssets Â· PR Newswire</small>"]:::external
    LogoDev["ğŸ–¼ï¸ logo.dev<br/><small>Company Logos CDN</small>"]:::external

    %% Connections
    User -->|"HTTPS"| OAuthProxy
    OAuthProxy -->|"Proxy Headers<br/><small>x-forwarded-user<br/>x-forwarded-groups</small>"| API
    API -->|"Serves static files"| FrontendStatic
    FrontendStatic -.->|"Logo images"| LogoDev

    API --> JobQueue
    API --> NewsFetcher
    JobQueue --> Orchestrator
    Cron --> NewsFetcher

    Orchestrator -->|"LLM Calls<br/><small>API Key Auth</small>"| Claude
    NewsFetcher -->|"LLM Categorization"| Claude
    NewsFetcher -->|"HTTP GET"| RSS
    Orchestrator --> Export
    Export --> Playwright

    API -->|"Prisma ORM<br/><small>Direct Connection</small>"| PostgreSQL
    JobQueue -->|"Advisory Locks"| PostgreSQL
    Orchestrator -->|"Stage Results"| PostgreSQL

    %% Polling note
    User -.->|"HTTP Polling<br/><small>2-5s interval</small>"| API
